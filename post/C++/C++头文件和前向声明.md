# C++ 头文件和前向声明

## 前向声明

前向声明类A，在声明之后定义之前，类A是一个不完整的类（imcomplete type，只知道A的类型，不知道A中的成员结构和大小，不能用来定义类对象，只能用于定义指向类指针和引用，或者作为形参类型或返回值。

前向声明只能用于定义指针或者引用，因为前向声明，只是声明没有定义，编译器不知道类的数据结构和大小，就会报错`field X has incomplete type XX`。

```c
// A.h
class B;
class A{
public:
	B *b;
};

// B.h
class B{
public:
	A *a;
};
```

上面这个例子，如果换成引用，就有点麻烦了，因为引用要使用初始化列表，先于构造函数进行初始化，需要有一个B的对象，但是B中同样也要有A的对象进行初始化，这就引起递归调用，导致堆栈溢出。



## 头文件

头文件包含比较复杂，头文件中的宏定义的展开也比较耗时，远不如自定义函数快。

类需要的头文件，尽量在cpp中包含，在头文件中使用前向声明。在cpp中只引用需要的头文件，不需要的头文件不引用。

需要包含头文件的情况：

- 类继承其他类
- 类中包含其他类成员

可以使用前向声明代替头文件的情况：

- 类中包含其他类的指针成员或引用成员
- 类中函数的参数值或返回值是其他类（类，指针，引用）



## .h.gch文件

不小心对头文件使用g++命令，生成`.h.gch`文件，它是预编译文件，如果不存在的话使用`.h`文件。

在编译`.o`文件的时候，为了加速编译，优先使用`.gch`文件，这样你后续修改代码，并不会改变`.gch`所以怎么调试都不行。把这个文件删除就行。

